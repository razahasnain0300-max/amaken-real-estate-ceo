<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mr. Essa ALmullah — CEO | Amaken Real Estate</title>
<meta name="description" content="Executive business card — Mr. Essa ALmullah, CEO — Amaken Real Estate">

<link rel="icon" href="uploads/pic2.png">

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<!-- Export libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{
    --deep:#071233;
    --gold:#c9a247;
    --muted:#6b7280;
    --bg: linear-gradient(135deg,#04112a 0%, #0b2e55 50%, #0f3a6b 100%);
    --card-bg:#ffffff;
    --radius:14px;
    font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:var(--bg);
    display:flex;
    align-items:flex-start;        /* show content from top on mobile */
    justify-content:center;
    padding:28px 18px;
    -webkit-font-smoothing:antialiased;
  }

  /* Shell */
  .shell{
    width:100%;
    max-width:980px;
    background:linear-gradient(180deg,#fbfbfe,#ffffff);
    border-radius:16px;
    overflow:hidden;
    border:1px solid rgba(0,0,0,0.04);
    transform-origin:top center;
    animation: shellIn .55s ease both;
  }
  @keyframes shellIn { from{opacity:0; transform: translateY(14px) scale(.995)} to{opacity:1; transform:none} }

  /* Header */
  .header{
    display:flex;
    gap:16px;
    align-items:center;
    padding:18px;
    background:linear-gradient(90deg,var(--deep),#0f3a6b);
    color:#fff;
  }
  .logo{
    width:72px;height:72px;border-radius:12px;overflow:hidden;border:3px solid rgba(201,162,71,0.95);background:#fff;flex-shrink:0;
    display:flex; align-items:center; justify-content:center;
    animation: logoPulse 3s ease-in-out infinite;
  }
  @keyframes logoPulse { 0%{transform:scale(1)} 50%{transform:scale(1.02)} 100%{transform:scale(1)} }
  .header img{width:100%;height:100%;object-fit:contain}
  .meta h1{margin:0;font-size:20px;font-weight:800}
  .meta p{margin:6px 0 0;font-size:13px;opacity:.95}

  /* Intro */
  .intro{
    padding:16px 22px;
    color:#223;
    line-height:1.6;
    border-bottom:1px solid #eef2f6;
    background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,252,0.98));
  }
  .intro strong{color:var(--deep)}

  /* Card zone */
  .container{padding:22px}
  .card{
    display:flex;
    gap:22px;
    padding:20px;
    background:var(--card-bg);
    border-radius:12px;
    border:1px solid rgba(10,42,102,0.06);
    align-items:flex-start;
    animation: cardIn .45s ease both;
  }
  @keyframes cardIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

  /* Images */
  .images{display:flex;flex-direction:column;align-items:center;gap:12px;flex:0 0 180px}
  .images img{width:150px;height:150px;object-fit:cover;border-radius:12px;border:4px solid #fff; transition:transform .28s,box-shadow .28s}
  .images img:hover{transform:translateY(-6px);}
  .companyLogo{width:100px}

  /* Info */
  .info{flex:1;min-width:220px}
  .fullname{font-size:22px;font-weight:800;color:var(--deep);display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .badge{padding:6px 12px;border-radius:999px;background:rgba(201,162,71,0.12);font-weight:700;color:var(--deep);font-size:12px}
  .role{margin-top:8px;color:var(--muted);font-size:14px}
  .companyName{font-size:15px;font-weight:700;margin-top:6px;color:#12223b}

  /* details grid */
  .details{margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:10px 20px;font-size:14px;color:#2d3b4a}
  .detail{display:flex;gap:8px;align-items:flex-start}
  .detail i{width:20px;color:var(--gold);text-align:center;flex-shrink:0}

  /* actions */
  .actions{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;transition:transform .18s,box-shadow .18s}
  .btn:hover{transform:translateY(-4px);}
  .btn.primary{background:linear-gradient(90deg,var(--gold),#e6c86b);color:#071233}
  .btn.secondary{background:var(--deep);color:#fff}
  .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:#222}

  .status{margin-top:12px;font-size:13px;color:var(--muted)}

  .footer{padding:12px;text-align:center;color:#667;font-size:13px;border-top:1px solid #eef2f6}

  /* responsive: stacked, image above details */
  @media (max-width:820px){
    body{align-items:flex-start;padding-top:36px} /* ensure header visible on mobile */
    .card{flex-direction:column;align-items:center;text-align:center}
    .images{flex-direction:row;gap:12px;justify-content:center;flex-wrap:wrap}
    .details{grid-template-columns:1fr}
    .info{text-align:center}
    .companyLogo{display:none}
  }
  a{
    text-decoration: none;
    color:black
  }
</style>
</head>
<body>
  <div class="shell" role="main" aria-labelledby="pageTitle">
    <header class="header">
      <div class="logo" aria-hidden="true"><img id="headerLogo" src="uploads/pic2.png" alt="Amaken logo"></div>
      <div class="meta">
        <h1 id="pageTitle">Mr. Essa ALmullah</h1>
        <p>Chief Executive Officer — Amaken Real Estate</p>
      </div>
    </header>

    <div class="intro" aria-hidden="false">
      <strong>Executive Summary —</strong>
      Mr. Essa ALmullah is a seasoned real estate executive with an extensive record in brokerage, property management and advisory services across the UAE. He leads Amaken Real Estate with integrity, market insight and a client-first approach — delivering transparent, tailored property solutions for investors and occupiers.
    </div>

    <div class="container">
      <article id="card" class="card" aria-label="Executive business card — Mr. Essa ALmullah">
        <div class="images" aria-hidden="false">
          <img id="ceoPhoto" src="uploads/mr_essa.png" alt="Mr. Essa ALmullah">
          <img id="companyLogo" class="companyLogo" src="uploads/pic2.png" alt="Amaken logo">
        </div>

        <div class="info" id="cardInfo">
          <div class="fullname">Mr. Essa ALmullah <span class="badge">CEO</span></div>
          <div class="role">Chief Executive Officer — Amaken Real Estate</div>
          <div class="companyName">Amaken Real Estate Company — Founded 2008</div>

          <div class="details" role="list">
            <div class="detail" role="listitem"><i class="fa-solid fa-phone"></i><div><strong>Call</strong><br><a href="tel:+971564924444">+971 56 492 4444</a></div></div>
            <div class="detail" role="listitem"><i class="fa-brands fa-whatsapp"></i><div><strong>WhatsApp</strong><br><a href="https://wa.me/971564924444" target="_blank">+971 56 492 4444</a></div></div>
            <div class="detail" role="listitem"><i class="fa-solid fa-phone"></i><div><strong>Alternate</strong><br><a href="tel:+971504590300">+971 50 459 0300</a></div></div>
            <div class="detail" role="listitem"><i class="fa-solid fa-envelope"></i><div><strong>Email</strong><br><a href="mailto:sms.auh@gmail.com">sms.auh@gmail.com</a></div></div>
            <div class="detail" role="listitem"><i class="fa-solid fa-location-dot"></i><div><strong>Office</strong><br>Al Reem Tower, Office 1301, Dubai - UAE</div></div>
            <div class="detail" role="listitem"><i class="fa-solid fa-mailbox"></i><div><strong>P.O. Box</strong><br>29770</div></div>
          </div>

          <div class="actions" role="toolbar" aria-label="download actions">
            <button id="btnPdf" class="btn primary" title="Download PDF (card)"><i class="fa-solid fa-file-pdf"></i> PDF</button>
            <button id="btnPng" class="btn secondary" title="Download PNG (card)"><i class="fa-regular fa-image"></i> PNG</button>
            <button id="btnVcard" class="btn ghost" title="Download vCard"><i class="fa-regular fa-address-card"></i> vCard</button>
          </div>

          <div id="status" class="status" aria-live="polite">Status: Ready</div>
        </div>
      </article>
    </div>

    <div class="footer">© 2026 Amaken Real Estate — Executive Portfolio</div>
  </div>

<script>
/* ------------------------------
   Robust export + image inlining
   ------------------------------
   Behavior summary:
   1. On load, attempt to inline the page images (fetch -> dataURL). This is required for html2canvas to include images.
   2. If inlining fails (fetch failed or CORS), the export functions fall back to rendering a clone without images so downloads still succeed.
   3. Auto-download is attempted (may be blocked by browser). Manual buttons always work.
*/

const cfg = {
  filenameBase: 'Mr_Essa_ALmullah_Business_Card',
  autoDownloadOnOpen: true,
  autoDownloadDelayMs: 900
};

const businessCard = document.getElementById('card');
const btnPdf = document.getElementById('btnPdf');
const btnPng = document.getElementById('btnPng');
const btnVcard = document.getElementById('btnVcard');
const statusEl = document.getElementById('status');

function setStatus(s){ if(statusEl) statusEl.textContent = 'Status: ' + s; console.debug(s); }
function downloadBlob(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=> URL.revokeObjectURL(url), 1500);
}

/* Try to fetch an image and convert to data URL.
   Returns dataURL string or null on failure. */
async function fetchImageToDataURL(src){
  if(!src) return null;
  if(src.startsWith('data:')) return src;
  try{
    // Ensure we try both relative and absolute paths if user provided one without leading slash
    const resp = await fetch(src, { mode: 'cors' }); // requires same-origin or CORS allowed
    if(!resp.ok) throw new Error('HTTP ' + resp.status);
    const blob = await resp.blob();
    return await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = e => reject(e);
      reader.readAsDataURL(blob);
    });
  }catch(err){
    console.warn('fetchImageToDataURL failed for', src, err);
    return null;
  }
}

/* Inline all images within element. Returns true if all inlined. */
async function inlineImagesInElement(el){
  setStatus('Inlining images (attempt)...');
  const imgs = Array.from(el.querySelectorAll('img'));
  if(imgs.length === 0){ setStatus('No images to inline'); return true; }
  let allOk = true;
  for(const img of imgs){
    const src = img.getAttribute('src') || '';
    const data = await fetchImageToDataURL(src);
    if(data){
      img.src = data;
      // wait for it to load so html2canvas sees it
      await new Promise(r => { if(img.complete) r(); else img.addEventListener('load', r, { once:true }); });
    } else {
      // log and continue — will fallback later
      console.warn('Could not inline', src);
      allOk = false;
    }
  }
  setStatus(allOk ? 'Images inlined' : 'Image inlining partial/failed');
  return allOk;
}

/* Wait for images inside element to load or timeout */
function waitForImages(el, timeout = 4500){
  const imgs = Array.from(el.querySelectorAll('img'));
  if(!imgs.length) return Promise.resolve();
  return new Promise(resolve => {
    let done=false, count=0;
    const check = ()=>{ if(done) return; if(++count === imgs.length){ done=true; resolve(); } };
    imgs.forEach(img=>{
      if(img.complete && img.naturalWidth !== 0){ check(); return; }
      img.addEventListener('load', check, { once:true });
      img.addEventListener('error', check, { once:true });
    });
    setTimeout(()=>{ if(!done){ done=true; resolve(); } }, timeout);
  });
}

/* Render canvas robustly: try with images, if toDataURL fails (tainted), render clone with images removed */
async function renderCanvasRobust(el){
  await waitForImages(el, 3500);
  setStatus('Rendering canvas (with images)…');
  try{
    const canvas = await html2canvas(el, { scale: 2, useCORS: false, backgroundColor: '#ffffff' });
    // test toDataURL to detect taint
    try{ canvas.toDataURL(); }catch(err){ throw err; }
    return canvas;
  }catch(err){
    console.warn('Render with images failed — falling back to image-free render', err);
    // fallback: clone & remove images
    const clone = el.cloneNode(true);
    clone.querySelectorAll('img').forEach(i => i.remove());
    clone.style.position = 'fixed';
    clone.style.left = '-9999px';
    clone.style.top = '0';
    clone.style.opacity = '0';
    document.body.appendChild(clone);
    await new Promise(r => setTimeout(r, 250));
    try{
      const canvas = await html2canvas(clone, { scale: 2, useCORS: false, backgroundColor: '#ffffff' });
      document.body.removeChild(clone);
      return canvas;
    }catch(e){
      document.body.removeChild(clone);
      throw e;
    }
  }
}

/* Export helpers */
async function exportPNG(){
  try{
    setStatus('Generating PNG...');
    const canvas = await renderCanvasRobust(businessCard);
    const blob = await new Promise(res => canvas.toBlob(res, 'image/png', 0.95));
    downloadBlob(blob, cfg.filenameBase + '.png');
    setStatus('PNG downloaded');
  }catch(e){
    console.error('exportPNG failed', e);
    setStatus('PNG failed — check console');
  }
}
async function exportPDF(){
  try{
    setStatus('Generating PDF...');
    const canvas = await renderCanvasRobust(businessCard);
    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF({ unit: 'mm', format: 'a4', orientation: 'portrait' });
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();
    const pxToMm = px => (px * 25.4) / 96;
    const imgWmm = pxToMm(canvas.width);
    const imgHmm = pxToMm(canvas.height);
    const margin = 12;
    const scale = Math.min((pageW - margin * 2) / imgWmm, (pageH - margin * 2) / imgHmm, 1);
    const finalW = imgWmm * scale;
    const finalH = imgHmm * scale;
    const x = (pageW - finalW) / 2;
    const y = (pageH - finalH) / 2;
    pdf.addImage(imgData, 'PNG', x, y, finalW, finalH, undefined, 'FAST');
    const blob = pdf.output('blob');
    downloadBlob(blob, cfg.filenameBase + '.pdf');
    setStatus('PDF downloaded');
  }catch(e){
    console.error('exportPDF failed', e);
    setStatus('PDF failed — check console');
  }
}
function exportVCard(){
  setStatus('Preparing vCard...');
  const vcard = [
    'BEGIN:VCARD','VERSION:3.0',
    'N:ALmullah;Essa;;;',
    'FN:Mr. Essa ALmullah',
    'ORG:Amaken Real Estate',
    'TITLE:Chief Executive Officer',
    'TEL;WORK;VOICE:+971564924444',
    'TEL;WORK;VOICE:+971504590300',
    'EMAIL;WORK:sms.auh@gmail.com',
    'ADR;WORK:;;Al Reem Tower, Office 1301, Dubai - UAE;;;',
    'END:VCARD'
  ].join('\r\n');
  const blob = new Blob([vcard], { type: 'text/vcard' });
  downloadBlob(blob, cfg.filenameBase + '.vcf');
  setStatus('vCard downloaded');
}

/* UI binding */
btnPng.addEventListener('click', exportPNG);
btnPdf.addEventListener('click', exportPDF);
btnVcard.addEventListener('click', exportVCard);

/* On load: attempt to inline images (if possible), then auto-download (if allowed) */
window.addEventListener('load', async ()=>{
  try{
    setStatus('Validating images and preparing card...');
    await inlineImagesInElement(businessCard); // tries to inline; if fails it logs warnings
    await new Promise(r => setTimeout(r, 350)); // let DOM settle
    setStatus('Ready');

    if(cfg.autoDownloadOnOpen){
      setTimeout(async ()=>{
        try{
          setStatus('Auto-download: preparing PDF...');
          await exportPDF();
        }catch(e){
          console.warn('Auto-download blocked/failed', e);
          setStatus('Auto-download blocked or failed — use Download PDF button');
        }
      }, cfg.autoDownloadDelayMs);
    }
  }catch(e){
    console.error('Initialization error', e);
    setStatus('Initialization error — see console');
  }
});

/* Debugging helper */
console.info('If images do not appear in exported PDF: ensure uploads/* files exist and are served same-origin or enable Access-Control-Allow-Origin on the image host.');
</script>
</body>
</html>
